{% extends 'base.html' %}

{% block title %}Edit Recipe - Easy Cooking{% endblock %}

{% block content %}
<form action="{{ url_for('edit_recipe', recipe_name=recipe.name) }}" method="post" class="pure-form pure-form-stacked">
    <fieldset>
        <legend><b>Edit a recipe</b></legend>
        <button type="submit" class="upload pure-button pure-button-primary">Update</button>
        <div class="pure-g">
            
            <div class="pure-u-1 pure-u-md-1-2 breaker">
                <label for="stacked-name"><b>Recipe Name</b></label>
                <input class="pure-u-1-4" type="text" id="stacked-name" name="recipe_name" required value="{{ recipe.name }}" placeholder="Enter the Recipe Name" />
            </div>

            <div class="pure-u-1 pure-u-md-1-2 breaker">
                <label for="stacked-author"><b>Author</b></label>
                <input type="text" id="stacked-author" name="author" value="{{session.userinfo.name}}" readonly>
            </div>

            <div class="pure-u-1 pure-u-md-1-2 breaker">
                <label for="stacked-image"><b>Image Link</b></label>
                <input class="pure-u-1-4" type="text" id="stacked-image" name="recipe_image" value="{{ recipe.image }}" placeholder="Enter Image Link. Optional." />
            </div>

            <div class="pure-u-1 pure-u-md-1-2 breaker">
                <label for="stacked-video"><b>Recipe Video</b></label>
                <input class="pure-u-1-4" type="text" id="stacked-video" name="recipe_video" value="{{ recipe.video_link }}" placeholder="Enter Video Link. Optional." />
            </div>

            <div class="pure-u-1">
                <div id="input-group-item" class="pure-u-1-2 input-group-item breaker">
                    <div class="pure-u-1 pure-u-md-1-3 ">
                        <label for="stacked-category"><b>Category</b></label>
                        <select name="stacked-category" id="stacked-category" class="pure-form-select">
                            {% for category in categories %}
                            <option value="{{ category }}" {% if category == selected_category %}selected{% endif %}>
                                {{ category }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
        
                    <div class="pure-u-1 pure-u-md-1-3">
                        <label for="stacked-spiciness"><b>Spiciness</b></label>
                        <select name="stacked-spiciness" id="stacked-spiciness" class="pure-form-select">
                            {% for spicy in spiciness %}
                            <option value="{{ spicy }}" {% if spicy == selected_spiciness %}selected{% endif %}>
                                {{ spicy }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
        
                    <div class="pure-u-1 pure-u-md-1-3">
                        <label for="stacked-difficulty"><b>Difficulty</b></label>
                        <select name="stacked-difficulty" id="stacked-difficulty" class="pure-form-select">
                            {% for difficulty in difficulties %}
                            <option value="{{ difficulty }}" {% if difficulty == selected_difficulty %}selected{% endif %}>
                                {{ difficulty }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>

            <div id="input-group-item" class="pure-u-1-2 input-group-item breaker">
                <div class="pure-u-1 pure-u-md-1-3">
                    <label for="checkbox-nut" class="pure-checkbox">
                        <input type="checkbox" name="nut" id="checkbox-nut" {% if nut_free %}checked{% endif %}> Nut Free
                    </label>
                </div>
    
                <div class="pure-u-1 pure-u-md-1-3">
                    <label for="checkbox-dairy" class="pure-checkbox">
                        <input type="checkbox" name="dairy" id="checkbox-dairy" {% if dairy_free %}checked{% endif %}> Dairy Free
                    </label>
                </div>
    
                <div class="pure-u-1 pure-u-md-1-3">
                    <label for="checkbox-vegetarian" class="pure-checkbox">
                        <input type="checkbox" name="vegetarian" id="checkbox-vegetarian" {% if vegan %}checked{% endif %}> Vegetarian
                    </label>
                </div>
            </div>
            

            <div class="pure-u-1 pure-u-md-1-2 breaker">
                <label for="stacked-description"><b>Description</b></label>
                <textarea class="pure-u-3-5" id="stacked-description" name="description" placeholder="Recipe Description. Optional.">{{ description }}</textarea>
            </div>
            
            <div class="pure-u-1">
                <div id="input-group-item" class="pure-u-1-2 input-group-item breaker">
                        <div class="pure-u-1 pure-u-md-1-3">
                            <label for="stacked-ingredients"><b>Ingredients</b></label>
                            {% for ingredient in ingredients %}
                            <div id="ingredients-list" class="stacked-ingredients">
                                <div class="ingredient-container">
                                    <input type="text" placeholder="Enter ingredient" name="ingredients[]" value="{{ ingredient }}">
                                </div>
                            </div>
                            {% endfor %}
                        </div>
        
                        <div class="pure-u-1 pure-u-md-1-3">
                            <label for="stacked-quantity"><b>Quantity</b></label>
                            {% for quantity in quantities %}
                            <div id="quantity-list" class="stacked-quantity">
                                <div class="quantity-container">
                                    <input type="text" placeholder="e.g. 10, 20, 300" name="quantity[]" value="{{ quantity }}">
                                </div>
                            </div>
                            {% endfor %}
                        </div>
        
                        <div class="pure-u-1 pure-u-md-1-3">
                            <label for="stacked-measurement"><b>Measurement</b></label>
                            {% for measurement in measurements %}
                            <div id="measurement-list" class="stacked-measurement">
                                <div class="measurement-container">
                                    <select name="measurement[]">
                                        <option selected disabled>Choose Measurement. Select blank if not sure.</option>
                                        <option value="cup" {% if measurement == 'cup' %}selected{% endif %}>cup</option>
                                        <option value="oz" {% if measurement == 'oz' %}selected{% endif %}>oz</option>
                                        <option value="ml" {% if measurement == 'ml' %}selected{% endif %}>ml</option>
                                        <option value="gallons" {% if measurement == 'gallons' %}selected{% endif %}>gallons</option>
                                        <option value="tablespoons" {% if measurement == 'tablespoons' %}selected{% endif %}>tablespoons</option>
                                        <option value="g" {% if measurement == 'g' %}selected{% endif %}>g</option>
                                        <option value="lb" {% if measurement == 'lb' %}selected{% endif %}>lb</option>
                                        <option value="drops" {% if measurement == 'drops' %}selected{% endif %}>drops</option>
                                        <option value="spring" {% if measurement == 'spring' %}selected{% endif %}>spring</option>
                                        <option value="sheets" {% if measurement == 'sheets' %}selected{% endif %}>sheets</option>
                                        <option value="slices" {% if measurement == 'slices' %}selected{% endif %}>slices</option>
                                        <option value=" " {% if measurement == ' ' %}selected{% endif %}></option>
                                    </select>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                </div>
            </div>
            

            <div class="pure-u-1 pure-u-md-1-2 breaker2">
                <button type="button" id="add-ingredient" class="pure-button pure-button-primary">Add</button>
                <button type="button" id="delete-ingredient" class="pure-button pure-button-primary delete-btn">Delete</button>
            </div>

            <div class="pure-u-1 pure-u-md-1-2 breaker">
                <label for="stacked-instructions"><b>Instructions</b></label>
                {% for instruction in instructions %}
                <div id="instructions-list" class="stacked-instructions">
                    <div class="instruction-container">
                        <input type="text" class="pure-input-2-3" placeholder="Enter instruction" value="{{ instruction }}" name="instructions[]">
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <div class="pure-u-1 pure-u-md-1-2">
                <button type="button" id="add-instruction" class="pure-button pure-button-primary">Add</button>
                <button type="button" id="delete-instruction" class="pure-button pure-button-primary delete-btn">Delete</button>
            </div>
        </div>
    </fieldset>
</form>

<form action="{{ url_for('delete_recipe', recipe_id=recipe.rid) }}" method="post" class="pure-form" onsubmit="return confirm('Are you sure you want to delete this recipe?');">
    <button type="submit" class="delete-recipe pure-button pure-button-error">Delete</button>
</form> 

<script>
    document.getElementById('add-ingredient').addEventListener('click', function() {
        var ingredientsList = document.getElementById('ingredients-list');
        var quantityList = document.getElementById('quantity-list');
        var measurementList = document.getElementById('measurement-list');

        var newIngredient = document.createElement('div');
        newIngredient.classList.add('ingredient-container');
        newIngredient.innerHTML = '<input type="text" placeholder="Enter ingredient" name="ingredients[]">';
        ingredientsList.appendChild(newIngredient);

        var newQuantity = document.createElement('div');
        newQuantity.classList.add('quantity-container');
        newQuantity.innerHTML = '<input type="text" placeholder="e.g. 10, 20, 300" name="quantity[]">';
        quantityList.appendChild(newQuantity);

        var newMeasurement = document.createElement('div');
        newMeasurement.classList.add('measurement-container');
        newMeasurement.innerHTML = 
                            `
                            <select name="measurement[]">
                                <option selected disabled>Choose Measurement. Select blank if not sure.</option>
                                <option value="cup">cup</option>
                                <option value="oz">oz</option>
                                <option value="ml">ml</option>
                                <option value="gallons">gallons</option>
                                <option value="tablespoons">tablespoons</option>
                                <option value="g">g</option>
                                <option value="lb">lb</option>
                                <option value="drops">drops</option>
                                <option value="spring">spring</option>
                                <option value="sheets">sheets</option>
                                <option value="slices">slices</option>
                                <option value=" "> </option>
                            </select>
                            `
        measurementList.appendChild(newMeasurement);
    });

    document.getElementById('delete-ingredient').addEventListener('click', function() {
        var ingredientsList = document.getElementById('ingredients-list');
        var lastIngredient = ingredientsList.lastElementChild;
        if (lastIngredient) {
            ingredientsList.removeChild(lastIngredient);
        }

        var quantityList = document.getElementById('quantity-list');
        var lastQuantity = quantityList.lastElementChild;
        if (lastQuantity) {
            quantityList.removeChild(lastQuantity);
        }

        var measurementList = document.getElementById('measurement-list');
        var lastMeasurement = measurementList.lastElementChild;
        if (lastMeasurement) {
            measurementList.removeChild(lastMeasurement);
        }
    });

    document.getElementById('add-instruction').addEventListener('click', function() {
        var instructionsList = document.getElementById('instructions-list');
        var newInstruction = document.createElement('div');
        newInstruction.classList.add('instruction-container');
        newInstruction.innerHTML = '<input type="text" class="pure-input-2-3" placeholder="Enter instruction" name="instructions[]">';
        instructionsList.appendChild(newInstruction);
    });

    document.getElementById('delete-instruction').addEventListener('click', function() {
        var instructionsList = document.getElementById('instructions-list');
        var lastInstruction = instructionsList.lastElementChild;
        if (lastInstruction) {
            instructionsList.removeChild(lastInstruction);
        }
    });
</script>

{% endblock %}

